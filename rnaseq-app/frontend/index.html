<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>RNA-seq Quick Runner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body{background:#0f172a;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;padding:32px}
      h1{margin:0 0 16px;font-weight:700}
      .card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:20px;max-width:920px}
      .row{display:flex;gap:16px;flex-wrap:wrap}
      input[type=text]{background:#0b1220;color:#e5e7eb;border:1px solid #334155;border-radius:10px;padding:10px 12px;min-width:280px}
      input[type=file]{color:#e5e7eb}
      button{background:#10b981;border:0;border-radius:10px;color:#071318;padding:10px 16px;font-weight:700;cursor:pointer}
      button:disabled{opacity:.5;cursor:not-allowed}
      .muted{opacity:.7}

      #barwrap{height:10px;background:#1f2937;border-radius:8px;overflow:hidden;margin-top:8px}
      #bar{height:10px;width:0;background:#22c55e}

      /* FastQC content area */
      #status{
        width:100%;
        min-height:400px;
        background:#0b1220;
        border:1px solid #1f2937;
        border-radius:12px;
        padding:14px;
        overflow:auto;
      }
      .json{white-space:pre;overflow:auto;max-height:420px}
      iframe.fastqc-frame{
        width:100%;
        height:80vh;
        border:1px solid #1f2937;
        border-radius:8px;
        background:white;
      }

      /* NEW: per-plot gallery styles */
      #plots { margin-top:12px; }
      .fastqc-section { margin: 16px 0; }
      .fastqc-section h3 { margin: 0 0 8px; font-weight: 700; }
      .fastqc-card { display:inline-block; margin:.5rem; padding:.5rem; border:1px solid #1f2937; border-radius:10px; background:#0b1220; }
      .fastqc-card img { max-width:360px; height:auto; display:block; border-radius:6px; }
      .fastqc-card figcaption { font-size:.9rem; text-align:center; margin-top:.25rem; }
    </style>
  </head>
  <body>
    <h1>RNA-seq Quick Runner</h1>

    <div class="card">
      <div class="row">
        <input id="sample-name" type="text" placeholder="sample name" value="sample1">
        <div class="muted">Max upload ~2GB (per request). Files are stored in the backend volume.</div>
      </div>

      <form id="upload-form" class="row" style="margin-top:12px;">
        <input id="file-input" type="file" multiple accept=".fastq,.fq,.fastq.gz,.fq.gz">
        <button type="submit">Upload</button>
        <span id="upload-msg" class="muted"></span>
      </form>

      <div class="row" style="margin-top:12px;">
        <button id="run-btn" disabled>Run pipeline</button>
        <button id="refresh-btn" type="button">Refresh latest run</button>
        <span class="muted">Stages: FastQC → fastp → FastQC(post) → Summary</span>
      </div>

      <div id="barwrap" style="margin-top:8px;"><div id="bar"></div></div>

      <!-- area for JSON OR embedded FastQC HTML -->
      <div id="status" style="margin-top:12px">
        <div class="json">{ "tip": "Upload FASTQ(.gz), then click Run pipeline." }</div>
      </div>

      <!-- NEW: individual FastQC plots render here -->
      <div id="plots"></div>
    </div>

    <div class="card muted" style="margin-top:16px">
      <div>API base: <code id="api-label"></code></div>
    </div>
    <script src="./plots.js"></script>
    <script src="./main.js"></script>
  </body>
</html>
